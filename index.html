<!--index.html-->
<html>
<head>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <meta charset="UTF-8">
    <title>Creating Real-Time Charts with Flask</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css" rel="stylesheet">
    <link
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
        rel="stylesheet"
        />
        <!-- Google Fonts -->
        <link
        href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
        rel="stylesheet"
        />
        <!-- MDB -->
        <link
        href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.6.0/mdb.min.css"
        rel="stylesheet"
        />
</head>
    <p id="example">AJAX</p>
    <div class="masonry-wrapper">
        <button type="button" class="btn btn-primary show" data-mdb-toggle="modal" data-mdb-target="#exampleModal" id='execute' value='/watch?v=6hf0XEWUHEU'>
            Launch demo modal
        </button>
        <button type="button" class="btn btn-primary show" data-mdb-toggle="modal" data-mdb-target="#exampleModal" id='execute' value='/watch?v=WUHHIaIM-qQ'>
            Launch demo modal
        </button>
    </div>

    <div class="modal top fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-mdb-backdrop="true" data-mdb-keyboard="true">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
        <div class="modal-dialog modal-xl ">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">
                  
              </h5>
              <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class "row">
                    <div class="col-md-8">
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/6hf0XEWUHEU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                </div>
                <div class="row ">
                    <div class="col-md-6">
                        <canvas id="LineChart" width="300" height="200"></canvas>
                    </div>
                    <div class="col-md-6">
                        <canvas id="PieChart" width="300" height="200"></canvas>
                    </div>
                </div>
            </div>
          </div>
        </div>
      </div>
    
    
    <script>
        $('.show').click(function(){
            var value = $(this).val();
            console.log(this)
        
            var postdata = {
                'value':value
            }
            $.ajax({
                type: 'POST',
                url: '{{url_for("ajax")}}',
                data: JSON.stringify(postdata),
                dataType : 'JSON',
                contentType: "application/json",
                success: function(response){
                    showList(response)
                },
                error: function(request, status, error){
                    alert('ajax 통신 실패')
                    alert(error);
                }
            })
        })
        function showList(data){
            var line=document.getElementById('LineChart').getContext('2d')
            var pie=document.getElementById('PieChart').getContext('2d')
            var LineChart=new Chart(line,{
                type: 'line',
                data: {
                    labels: data.view_result['date'],
                    datasets: [{
                        label: '최근 5시간 조회수 변화',
                        data: data.view_result['view'],
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                        linetension: 0.1
                    }]
                },
                options: {

                }
            });
            var PieChart=new Chart(pie,{
                type:'doughnut',
                data:{
                    labels: ['negative','netural','positive'],
                    datasets:[{
                        data: data.sentiment_result['rate'],
                        fill:false,
                        backgroundColor: ['#E5FBB8','#F5E79D','#FE9898'],
                        hoverOffset:4
                    }]
                },
            })
            $(".modal-title").append(data.view_result['title'])
        }
    </script>
    
    <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.6.0/mdb.min.js"
  ></script>
    
</body>
</html>